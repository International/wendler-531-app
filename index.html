<!DOCTYPE html>
<html manifest='manifest.appcache'>
  <head>
    <title>Wendler 5-3-1 Cycle Calculator</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
    <script type="text/javascript" src="bootstrap.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="bootstrap.min.css">
    <style type="text/css">
      body {
        padding-top: 40px;
      }
      table {
        width: 100%;
        margin-bottom: 0;
      }
      .show-small {
        display: none;
      }
      section, footer {
        clear: left;
      }
      @media (max-width: 768px) {
        .navbar-fixed-top {
          margin-bottom: 0px;
        }
        body {
          padding-top: 0;
        }
        form {
          margin-bottom: 0;
        }
        #calculator {
          margin-top: -15px;
        }
        #calculator .btn {
          margin-left: 20px;
        }
        .hide-small, .page-header {
          display: none !important;
        }
        .show-small {
          display: inline !important;
        }
      }
      @media (max-width: 480px) {
        #calculator {
          padding-left: 2px;
        }
        #weight {
          margin-bottom: 5px;
          float: left;
        }
      }
    </style>
    <link rel="stylesheet" href="bootstrap-responsive.min.css">
    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11286410-1']);
  _gaq.push(['_setDomainName', 'paulswartz.net']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

    </script>
  </head>
  <body>
    <div class="container">
      <div class="navbar navbar-fixed-top">
        <div class="navbar-inner">
          <div class="container">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </a>
            <a class="brand" href="">Wendler <span class="hide-small">5-3-1 Cycle </span>Calculator</a>
            <div class="nav-collapse">
              <ul class="nav pull-right">
                <li class="dropdown">
                  <a href="#" class="dropdown-toggle hide-small" data-toggle="dropdown">Recent Weights <b class="caret hide-small"></b></a>
                  <ul id="recent-list" class="dropdown-menu">
                  </ul>
              </ul>
            </div>
         </div>
        </div>
      </div>
      <section class="hide-small">
        <div class="page-header"><h2>How to use</h2></div>
        <p>
          Enter your weight in the form below.  The page will update with the weights and reps you'll do to keep up with the Wendler 5/3/1 cycle.
        </p>
      </section>
      <section id="calculator">
        <div class="page-header"><h2>Setup</h2></div>
        <form class="form" action="javascript:recalculate();">
          <div class="controls">
            <input name="weight" id="weight" type="number" pattern="[0-9]*"  placeholder="Enter your 1-rep max" min="0" step="1" max="10000">
            <button type="submit" class="btn btn-primary"><span class="hide-small">Calculate</span><span class="show-small">&#x2713;</span></button>
          </div>
          <div class="controls hide-small">
            <label class="checkbox">
              <input checked name="rounding" id="rounding" type="checkbox"><span>Round down to nearest multiple of 5?</span>
              </label>
          </div>
        </form>
      </section>
      <section id="onerepmax">
        <div class="page-header"><h2>Working 1-Rep Max</h2></div>
        <p>
          All of your work for this cycle is based off a working 1-rep max of <strong><span id="working"></span></strong> pounds.
        </p>
      </section>
      <section id="chart">
        <div class="page-header"><h2>Schedule</h2></div>
        <table class="table table-striped table-bordered">
          <tr>
            <th>Week 1 <span class="hide-small">(5-5-5+, 65/75/85%)</span></th>
            <th>Week 2 <span class="hide-small">(3-3-3+, 70/80/90%)</span></th>
            <th>Week 3 <span class="hide-small">(5-3-1+, 75/85/95%)</span></th>
            <th>Week 4 <span class="hide-small">(deload)</span></th>
          </tr>
          <tr>
            <td data-reps="5" data-percent="40"></td>
            <td data-reps="5" data-percent="40"></td>
            <td data-reps="5" data-percent="40"></td>
            <td data-reps="5" data-percent="40"></td>
          </tr>
          <tr>
            <td data-reps="5" data-percent="50"></td>
            <td data-reps="5" data-percent="50"></td>
            <td data-reps="5" data-percent="50"></td>
            <td data-reps="5" data-percent="50"></td>
          </tr>
          <tr>
            <td data-reps="3" data-percent="60"></td>
            <td data-reps="3" data-percent="60"></td>
            <td data-reps="3" data-percent="60"></td>
            <td data-reps="5" data-percent="60"></td>
          </tr>
          <tr>
            <td data-reps="5" data-percent="65"></td>
            <td data-reps="3" data-percent="70"></td>
            <td data-reps="5" data-percent="75"></td>
            <td></td>
          </tr>
          <tr>
            <td data-reps="5" data-percent="75"></td>
            <td data-reps="3" data-percent="80"></td>
            <td data-reps="3" data-percent="85"></td>
            <td></td>
          </tr>
          <tr>
            <td class="final" data-reps="5+" data-percent="85"></td>
            <td class="final" data-reps="3+" data-percent="90"></td>
            <td class="final" data-reps="1+" data-percent="95"></td>
            <td></td>
          </tr>
        </table>
      </section>
      <footer id="about">
        <div class="page-header"><h2>About</h2></div>
        <p>This page was put together by <a href="http://paulswartz.net">Paul Swartz</a>.  You can find him on Twitter <a href="http://www.twitter.com/paulswartz">@paulswartz</a>.<span class="hide-small">  Source code available at <a href="https://github.com/paulswartz/wendler-531-app">Github</a>.</span></p>
      </footer>
    </div>
  </body>
  <script type="text/javascript">
    function round(val) {
        if (!$("#rounding").prop('checked')) {
            return val;
        } else {
            return Math.floor(val / 5) * 5;
        }
    }
    function getHash() {
        max = parseInt($("#weight").val());
        checked = $("#rounding").prop("checked");
        if (!checked) {
            return '#a' + max;
        } else {
            return '#' + max;
        }
    }
    function saveValue() {
        hash = getHash().slice(1);
        if (!hash) {
          return;
        }
        try {
            savedValues = localStorage.getItem("weights");
        } catch (e) {
        }
        if (!savedValues) {
            savedValues = "";
        }
        savedValuesList = savedValues.split('#');
        index = $.inArray(hash, savedValuesList);
        if (index == -1) { // not found
          savedValuesList.unshift(hash);
        }
        savedValuesList = savedValuesList.slice(0, 5);
        try {
            localStorage.setItem("weights", savedValuesList.join("#"));
        } catch (e) {}
        updateDropdown();
    }
    function updateDropdown() {
        try {
            savedValues = localStorage.getItem("weights");
        } catch (e) {
        }
        recentList = $("#recent-list")
        if (!savedValues) {
            recentList.html('<li><a>No recent weights</a></li>');
            return;
        }
        savedValuesList = savedValues.split('#');
        recentList.empty();
        for (i = 0; i < savedValuesList.length; i++) {
            max = savedValuesList[i];
            if (max) {
                linkText = max;
                if (max.slice(0, 1) == "a") {
                    linkText = max.slice(1) + ' (no rounding)';
                }
                active = ('#' + max == location.hash ? ' class="active"' : '');
                recentList.append('<li' + active + '><a href="#' + max + '">' + linkText + '</a></li>');
            }
        }
    }
    function recalculate() {
        max = parseInt($("#weight").val());
        if (isNaN(max)) {
            $("#onerepmax, #chart").hide();
            return;
        }
        $("#onerepmax, #chart").show();
        workingmax = parseInt(max * 0.9);
        $("#working").text(workingmax);
        $("td[data-percent]").each(function(index) {
            elm = $(this);
            percent = parseInt(elm.attr('data-percent'));
            reps = elm.attr('data-reps');
            w = round(parseInt(workingmax * percent * 0.01));
            elm.html(w + "#<span class='hide-small'>, </span><span class='show-small'>x</span>" + reps + "<span class='hide-small'> reps</span>");
        });
        location.hash = getHash();
        saveValue();
    }
    function handleHash() {
        var start;
        if (location.hash.slice(1, 2) === "a") {
            $("#rounding").prop("checked", false);
            start = 2;
        } else {
            $("#rounding").prop("checked", true);
            start = 1;
        }
        if (parseInt(location.hash.slice(start))) {
            $("#weight").val(location.hash.slice(start));
        }
        recalculate();
    }
    updateDropdown();
    $("#weight").change(recalculate);
    $("#rounding").change(recalculate);
    handleHash();
    window.onhashchange = function () {
        if (location.hash != getHash()) {
            handleHash();
        }
    }
    if ($.browser.webkit && navigator.userAgent.indexOf('Android ') != -1) {
        $("input[type=number]").prop('type', 'text');
    }
  </script>
</html>

